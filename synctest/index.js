(function(r,f,u,d,c){"use strict";const l="/storage/emulated/0/vendetta/",g=`${l}vendetta_data.json`;async function m(){await c.exists(l)||await c.mkdir(l)}async function v(){const n={themes:[],plugins:[]};for(const e of Object.values(u.plugins)){var i;const s=(i=vstorage.pluginSettings)===null||i===void 0?void 0:i[e.id];if(s?.syncPlugin===!1)continue;const o=s?.syncStorage===!1?{}:await f.createMMKVBackend(e.id).get();n.plugins.push({id:e.id,enabled:e.enabled,options:o})}for(const e of Object.values(d.themes))n.themes.push({id:e.id,enabled:e.selected});return await m(),await c.writeFile(g,JSON.stringify(n),"utf8"),n}async function h(){try{var n;const i=JSON.parse(await c.readFile(g,"utf8"));if(!i)return;const e=[...i.plugins.filter(function(t){return!u.plugins[t.id]&&canImport(t.id)&&options.unproxiedPlugins}),...i.plugins.filter(function(t){return!u.plugins[t.id]&&canImport(t.id)&&options.plugins})],s=i.themes.filter(function(t){return!d.themes[t.id]&&options.themes});if(!e[0]&&!s[0])return;const o={plugins:0,themes:0,failed:0};await Promise.all([...e.map(async function(t){try{await AsyncStorage.setItem(t.id,JSON.stringify(t.options)),o.plugins++}catch{o.failed++}}),...s.map(async function(t){try{o.themes++}catch{o.failed++}})]);const p=d.themes[(n=s.find(function(t){return t.enabled}))===null||n===void 0?void 0:n.id];p&&await f.createFileBackend("vendetta_theme.json").set(Object.assign(p,{selected:!0}))}catch{}}return r.grabEverything=v,r.importData=h,r})({},vendetta.storage,vendetta.plugins,vendetta.themes,a);
